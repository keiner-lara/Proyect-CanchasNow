<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scrum Board Editable</title>
  <style>
    :root{
      --bg:#f7f7fb;--card:#ffffff;--ink:#222;--muted:#6b7280;--line:#e5e7eb;--accent:#6c5ce7;
      --yellow:#fde68a;--purple:#e9d5ff;--pink:#fecdd3;--green:#bbf7d0;--blue:#bfdbfe;--orange:#fed7aa;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
    .app{max-width:1200px;margin:24px auto;padding:0 16px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:16px}
    .toolbar-left, .toolbar-right{display:flex;gap:8px;align-items:center}
    button, .btn{border:1px solid var(--line);background:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    button:hover{border-color:#c7cad1}
    .board{display:grid;grid-template-columns:repeat(7,1fr);gap:12px}
    @media (max-width:1100px){.board{grid-template-columns:repeat(4,1fr)}}
    @media (max-width:768px){.board{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){.board{grid-template-columns:1fr}}
    .column{background:var(--card);border:1px solid var(--line);border-radius:14px;display:flex;flex-direction:column;min-height:260px;max-height:70vh}
    .col-header{display:flex;align-items:center;justify-content:space-between;padding:12px 12px;border-bottom:1px solid var(--line)}
    .col-title{font-weight:800;font-size:14px;letter-spacing:.2px;padding:6px 8px;border-radius:8px}
    .col-title[contenteditable="true"]:focus{outline:2px solid rgba(108,92,231,.25);background:#fafaff}
    .col-body{padding:10px;display:flex;flex-direction:column;gap:10px;overflow:auto}
    .drop-hint{border:2px dashed #d1d5db;border-radius:12px;padding:18px;text-align:center;color:var(--muted);font-size:13px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px 10px 8px;box-shadow:0 1px 0 rgba(0,0,0,.03);cursor:grab}
    .card.dragging{opacity:.5}
    .card textarea{width:100%;border:none;resize:vertical;min-height:46px;font:inherit;color:inherit;background:transparent}
    .card textarea:focus{outline:none}
    .tags{display:flex;gap:6px;align-items:center;margin-bottom:6px}
    .tag{width:14px;height:14px;border-radius:4px;border:1px solid rgba(0,0,0,.08)}
    .controls{display:flex;gap:6px;justify-content:flex-end;margin-top:6px}
    .icon-btn{border:1px solid var(--line);background:#fff;border-radius:8px;padding:4px 6px;font-size:12px;cursor:pointer}
    .icon-btn:hover{background:#f3f4f6}
    .ghost{height:58px;border:2px dashed #c7cad1;border-radius:12px}
    .muted{color:var(--muted);font-size:12px}
    .footer{margin-top:14px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="app">
    <div class="toolbar">
      <div class="toolbar-left">
        <strong style="font-size:18px">📌 Scrum Board editable</strong>
        <span class="muted">Arrastra tarjetas entre columnas. Cambia títulos. Todo se guarda en tu navegador.</span>
      </div>
      <div class="toolbar-right">
        <button id="btn-export">Exportar JSON</button>
        <label class="btn" for="file-import">Importar JSON</label>
        <input id="file-import" type="file" accept="application/json" hidden />
        <button id="btn-new">Nuevo tablero</button>
        <button id="btn-print">Imprimir</button>
      </div>
    </div>

    <div id="board" class="board" aria-label="Scrum board"></div>

    <div class="footer">Adentrooooooooo</div>
  </div>

<script>
(function(){
  const DEFAULT_COLUMNS = [
    { id:"product_backlog", title:"Product Backlog" },
    { id:"user_story", title:"User Story" },
    { id:"work_to_do", title:"Work to Do" },
    { id:"work_in_progress", title:"Work in Progress" },
    { id:"on_hold", title:"On Hold" },
    { id:"work_done", title:"Work Done" },
    { id:"work_in_review", title:"Work in Review" }
  ];

  const COLORS = ["--yellow","--purple","--pink","--green","--blue","--orange"];
  const $ = s=>document.querySelector(s);
  const boardEl = $('#board');
  const STORE_KEY = 'scrum_board_v1';

  // State shape: { columns: [{id,title,cards:[{id,text,color}] }] }
  let state = loadState();

  function uid(){return Math.random().toString(36).slice(2,9)}
  function save(){localStorage.setItem(STORE_KEY, JSON.stringify(state))}
  function loadState(){
    const raw = localStorage.getItem(STORE_KEY);
    if(raw){
      try { return JSON.parse(raw); } catch(e){}
    }
    return { columns: DEFAULT_COLUMNS.map(c=>({ ...c, cards:[] })) };
  }

  function render(){
    boardEl.innerHTML = '';
    state.columns.forEach(col=>{
      const colEl = document.createElement('section');
      colEl.className = 'column';
      colEl.dataset.id = col.id;

      // header
      const header = document.createElement('div');
      header.className = 'col-header';

      const title = document.createElement('div');
      title.className = 'col-title';
      title.textContent = col.title;
      title.contentEditable = true;
      title.addEventListener('blur', ()=>{ col.title = title.textContent.trim() || col.title; save(); });

      const addBtn = document.createElement('button');
      addBtn.className = 'icon-btn';
      addBtn.textContent = '+ Nueva tarjeta';
      addBtn.addEventListener('click', ()=> createCardPrompt(col.id));

      header.appendChild(title);
      header.appendChild(addBtn);

      // body
      const body = document.createElement('div');
      body.className = 'col-body';
      body.addEventListener('dragover', e=>{ e.preventDefault(); body.classList.add('over');});
      body.addEventListener('dragleave', ()=> body.classList.remove('over'));
      body.addEventListener('drop', e=>{ e.preventDefault(); body.classList.remove('over'); handleDrop(col.id, e); });

      if(!col.cards.length){
        const hint = document.createElement('div');
        hint.className = 'drop-hint';
        hint.textContent = 'Suelta tarjetas aquí';
        body.appendChild(hint);
      }

      col.cards.forEach(card=> body.appendChild(cardEl(card, col.id)) );

      colEl.appendChild(header);
      colEl.appendChild(body);
      boardEl.appendChild(colEl);
    });
  }

  function cardEl(card, fromColId){
    const el = document.createElement('article');
    el.className = 'card';
    el.draggable = true;
    el.dataset.cardId = card.id;
    el.dataset.from = fromColId;

    el.addEventListener('dragstart', e=>{
      el.classList.add('dragging');
      e.dataTransfer.setData('text/plain', JSON.stringify({ id: card.id, from: fromColId }));
    });
    el.addEventListener('dragend', ()=> el.classList.remove('dragging'));

    const tags = document.createElement('div');
    tags.className = 'tags';
    const tag = document.createElement('span');
    tag.className = 'tag';
    tag.style.background = `var(${card.color||'--yellow'})`;
    tags.appendChild(tag);

    const ta = document.createElement('textarea');
    ta.value = card.text;
    ta.addEventListener('change', ()=>{ card.text = ta.value.trim(); save(); });
    ta.addEventListener('dblclick', ()=> ta.focus());

    const ctrls = document.createElement('div');
    ctrls.className = 'controls';

    const colorBtn = document.createElement('button');
    colorBtn.className = 'icon-btn';
    colorBtn.title = 'Cambiar color';
    colorBtn.textContent = '🎨';
    colorBtn.addEventListener('click', ()=>{
      const idx = (COLORS.indexOf(card.color)||0)+1;
      card.color = COLORS[idx % COLORS.length];
      tag.style.background = `var(${card.color})`;
      save();
    });

    const delBtn = document.createElement('button');
    delBtn.className = 'icon-btn';
    delBtn.title = 'Eliminar';
    delBtn.textContent = '🗑️';
    delBtn.addEventListener('click', ()=> deleteCard(fromColId, card.id));

    ctrls.appendChild(colorBtn);
    ctrls.appendChild(delBtn);

    el.appendChild(tags);
    el.appendChild(ta);
    el.appendChild(ctrls);

    return el;
  }

  function createCardPrompt(colId){
    const text = prompt('Texto de la tarjeta:');
    if(!text) return;
    const card = { id: uid(), text, color: COLORS[Math.floor(Math.random()*COLORS.length)] };
    const col = state.columns.find(c=>c.id===colId);
    col.cards.unshift(card);
    save();
    render();
  }

  function deleteCard(colId, cardId){
    const col = state.columns.find(c=>c.id===colId);
    col.cards = col.cards.filter(c=>c.id!==cardId);
    save();
    render();
  }

  function handleDrop(targetColId, ev){
    try{
      const data = JSON.parse(ev.dataTransfer.getData('text/plain'));
      if(!data) return;
      moveCard(data.from, targetColId, data.id);
    }catch(e){}
  }

  function moveCard(fromId, toId, cardId){
    if(fromId===toId) return;
    const from = state.columns.find(c=>c.id===fromId);
    const to = state.columns.find(c=>c.id===toId);
    const idx = from.cards.findIndex(c=>c.id===cardId);
    if(idx===-1) return;
    const [card] = from.cards.splice(idx,1);
    to.cards.unshift(card);
    save();
    render();
  }

  // Export / Import / New / Print
  $('#btn-export').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'scrum-board.json'; a.click();
    URL.revokeObjectURL(url);
  });

  $('#file-import').addEventListener('change', (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      try {
        const obj = JSON.parse(reader.result);
        if(!obj || !Array.isArray(obj.columns)) throw new Error('Formato inválido');
        state = obj; save(); render();
      } catch(err){ alert('JSON inválido'); }
    };
    reader.readAsText(file);
    e.target.value = '';
  });

  $('#btn-new').addEventListener('click', ()=>{
    if(confirm('¿Vaciar y crear un tablero nuevo?')){
      state = { columns: DEFAULT_COLUMNS.map(c=>({ ...c, cards:[] })) };
      save(); render();
    }
  });

  $('#btn-print').addEventListener('click', ()=> window.print());

  // First render
  render();
})();
</script>
</body>
</html>
